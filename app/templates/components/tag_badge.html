{% macro tag_badge(tag, extra_classes="", editable=false) %}
{# Semantic color mapping for common tags #}
{% set semantic_colors = {
  'work': 'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400',
  'personal': 'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400',
  'urgent': 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400',
  'meeting': 'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400',
  'idea': 'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400',
  'todo': 'bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400',
  'important': 'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400',
  'private': 'bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400',
  'project': 'bg-indigo-100 text-indigo-800 dark:bg-indigo-900/30 dark:text-indigo-400',
  'review': 'bg-pink-100 text-pink-800 dark:bg-pink-900/30 dark:text-pink-400',
  'misc': 'bg-slate-100 text-slate-800 dark:bg-slate-900/30 dark:text-slate-400',
  'reminder': 'bg-emerald-100 text-emerald-800 dark:bg-emerald-900/30 dark:text-emerald-400',
} %}

{# Fallback color palette for unknown tags - simple cycling #}
{% set color_palette = [
  'bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400',
  'bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400',
  'bg-purple-100 text-purple-800 dark:bg-purple-900/30 dark:text-purple-400',
  'bg-yellow-100 text-yellow-800 dark:bg-yellow-900/30 dark:text-yellow-400',
  'bg-red-100 text-red-800 dark:bg-red-900/30 dark:text-red-400',
  'bg-indigo-100 text-indigo-800 dark:bg-indigo-900/30 dark:text-indigo-400',
  'bg-pink-100 text-pink-800 dark:bg-pink-900/30 dark:text-pink-400',
  'bg-orange-100 text-orange-800 dark:bg-orange-900/30 dark:text-orange-400',
  'bg-teal-100 text-teal-800 dark:bg-teal-900/30 dark:text-teal-400',
  'bg-cyan-100 text-cyan-800 dark:bg-cyan-900/30 dark:text-cyan-400'
] %}

{% set tag_lower = tag.lower() %}
{% if tag_lower in semantic_colors %}
  {% set color_class = semantic_colors[tag_lower] %}
{% else %}
  {# Simple index-based color assignment for unknown tags #}
  {% set hash = tag_lower|length %}
  {% set color_index = hash % color_palette|length %}
  {% set color_class = color_palette[color_index] %}
{% endif %}

<span class="inline-block px-2 py-1 rounded-full text-xs font-medium {{ color_class }} {{ extra_classes }}" data-tag="{{ tag }}">
    {{ tag }}
    {% if editable %}
    <svg class="w-3 h-3 inline-block ml-1 opacity-0 group-hover:opacity-100 transition" fill="none"
        viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
    </svg>
    {% endif %}
</span>
{% endmacro %}
